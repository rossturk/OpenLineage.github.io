<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.d5fe48b6cb84108d2593.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.bg-bg{--bg-opacity:1;background-color:#f8f8f8;background-color:rgba(248,248,248,var(--bg-opacity))}.bg-bgalt{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.border-primary{--border-opacity:1;border-color:#47576e;border-color:rgba(71,87,110,var(--border-opacity))}.border-secondary{--border-opacity:1;border-color:#3e3e3e;border-color:rgba(62,62,62,var(--border-opacity))}.hover\:border-primary:hover{--border-opacity:1;border-color:#47576e;border-color:rgba(71,87,110,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.border-2{border-width:2px}.border-t-2{border-top-width:2px}.box-border{box-sizing:border-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.hidden{display:none}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.flex-1{flex:1 1 0%}.font-sans{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.font-bold{font-weight:700}.h-6{height:1.5rem}.h-8{height:2rem}.h-12{height:3rem}.h-px{height:1px}.h-full{height:100%}.h-screen{height:100vh}.text-base{font-size:1rem}.text-lg{font-size:1.125rem}.text-3xl{font-size:1.875rem}.text-5xl{font-size:3rem}.text-6xl{font-size:4rem}.text-7xl{font-size:5rem}.m-3{margin:.75rem}.my-2{margin-top:.5rem;margin-bottom:.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.my-3{margin-top:.75rem;margin-bottom:.75rem}.mx-3{margin-left:.75rem;margin-right:.75rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-5{margin-left:1.25rem;margin-right:1.25rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-1{margin-top:.25rem}.mr-2{margin-right:.5rem}.ml-2{margin-left:.5rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.ml-4{margin-left:1rem}.mt-5{margin-top:1.25rem}.mb-6{margin-bottom:1.5rem}.mt-8{margin-top:2rem}.mt-12{margin-top:3rem}.mb-12{margin-bottom:3rem}.mt-20{margin-top:5rem}.max-w-none{max-width:none}.focus\:outline-none:focus,.outline-none{outline:2px solid transparent;outline-offset:2px}.overflow-hidden{overflow:hidden}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-2px{padding:2px}.px-0{padding-left:0;padding-right:0}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.py-12{padding-top:3rem;padding-bottom:3rem}.pt-1{padding-top:.25rem}.pl-2{padding-left:.5rem}.pt-3{padding-top:.75rem}.pt-4{padding-top:1rem}.pt-6{padding-top:1.5rem}.pb-6{padding-bottom:1.5rem}.pt-8{padding-top:2rem}.pb-12{padding-bottom:3rem}.pb-20{padding-bottom:5rem}.pb-40{padding-bottom:10rem}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.top-0{top:0}.bottom-0{bottom:0}.left-0{left:0}.resize-none{resize:none}.resize{resize:both}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.shadow-xl{box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04)}.focus\:shadow-2xl:focus,.hover\:shadow-2xl:hover,.shadow-2xl{box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}.stroke-current{stroke:currentColor}.text-center{text-align:center}.text-color-default{--text-opacity:1;color:#3e3e3e;color:rgba(62,62,62,var(--text-opacity))}.text-color-1{--text-opacity:1;color:#47576e;color:rgba(71,87,110,var(--text-opacity))}.text-color-2{--text-opacity:1;color:#74a4bc;color:rgba(116,164,188,var(--text-opacity))}.text-color-3{--text-opacity:1;color:#f26522;color:rgba(242,101,34,var(--text-opacity))}.text-color-4{--text-opacity:1;color:#3e3e3e;color:rgba(62,62,62,var(--text-opacity))}.text-primary{--text-opacity:1;color:#47576e;color:rgba(71,87,110,var(--text-opacity))}.text-secondary{--text-opacity:1;color:#3e3e3e;color:rgba(62,62,62,var(--text-opacity))}.text-link{--text-opacity:1;color:#f26522;color:rgba(242,101,34,var(--text-opacity))}.text-white{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.focus\:text-primary:focus{--text-opacity:1;color:#47576e;color:rgba(71,87,110,var(--text-opacity))}.uppercase{text-transform:uppercase}.align-middle{vertical-align:middle}.whitespace-pre{white-space:pre}.w-12{width:3rem}.w-16{width:4rem}.w-40{width:10rem}.w-auto{width:auto}.w-4\/5{width:80%}.w-full{width:100%}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.scale-0{--transform-scale-x:0;--transform-scale-y:0}.scale-100{--transform-scale-x:1;--transform-scale-y:1}.transition-all{transition-property:all}.transition-shadow{transition-property:box-shadow}.transition-transform{transition-property:transform}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}.theme-dark .bg-bg{background-color:#3e3e3e}.theme-dark .bg-bgalt{background-color:#000}.theme-dark .border-primary{border-color:#f8f8f8}.theme-dark .border-secondary{border-color:#fff}.theme-dark .text-color-default{color:#a8a8aa}.theme-dark .text-color-1,.theme-dark .text-primary{color:#f8f8f8}.theme-dark .text-secondary{color:#fff}.bg-gradient-primary{background-image:linear-gradient(90deg,#47576e,#3e3e3e)}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}body{font-family:Didact Gothic,sans-serif}p{line-height:165%}.boxed{max-width:1024px;width:100%;margin-left:auto;margin-right:auto;padding-left:1rem;padding-right:1rem}.large-container{max-width:2100px}@media (min-width:1024px){.boxed{max-width:768px}}@media (min-width:1280px){.boxed{max-width:1024px}}.nav .nav-links li{position:relative;display:inline-block;margin-left:.5rem;margin-right:.5rem}.nav .nav-links li a{display:inline-block;padding:.25rem;position:relative;z-index:10}.nav .nav-links li:before{content:"";position:absolute;width:0;height:0;border-radius:9999px;--bg-opacity:1;background-color:#47576e;background-color:rgba(71,87,110,var(--bg-opacity));left:0;right:0;bottom:0;top:0;margin:auto;opacity:.25;transition:width .25s,height .25s}.nav .nav-links li.active a,.nav .nav-links li:hover a{color:#f26522}.nav .nav-links .theme-switcher:before{display:none}.nav .line{width:0;transition:width .5s}.nav.scrolled .line{width:100%}.title h1{--text-opacity:1;color:#47576e;color:rgba(71,87,110,var(--text-opacity))}.btn{height:3rem;padding-left:1.5rem;padding-right:1.5rem;outline:2px solid transparent;outline-offset:2px;display:inline-flex;position:relative;overflow:hidden;align-items:center}.btn.disabled{opacity:.5}.btn span{position:relative;z-index:10}.btn:before{content:"";position:absolute;width:100%;height:100%;top:0;left:100%;transition:left .25s;transition-timing-function:cubic-bezier(1,2.13,1,-.1);z-index:1}.btn .icon-right{margin-left:.75rem}.btn .icon-left{margin-right:.75rem}.btn:focus{outline:2px solid transparent;outline-offset:2px}.btn-primary{--bg-opacity:1;background-color:#47576e;background-color:rgba(71,87,110,var(--bg-opacity));margin-top:1rem;margin-bottom:1rem;color:#fff}.btn-primary:before{--bg-opacity:1;background-color:#3e3e3e;background-color:rgba(62,62,62,var(--bg-opacity))}.btn-primary:focus:before,.btn-primary:hover:before{left:0}.integration-item .image{-webkit-clip-path:polygon(0 0,0 0,0 100%,0 100%);clip-path:polygon(0 0,0 0,0 100%,0 100%);transition:-webkit-clip-path .5s;transition:clip-path .5s;transition:clip-path .5s,-webkit-clip-path .5s;transition-timing-function:ease-in-out;z-index:3;transform:translateY(0)}.integration-item.even .image{-webkit-clip-path:polygon(100% 0,100% 0,100% 99%,100% 100%);clip-path:polygon(100% 0,100% 0,100% 99%,100% 100%)}.integration-item.begin-animation .image{-webkit-clip-path:polygon(0 0,100% 0,100% 100%,0 100%);clip-path:polygon(0 0,100% 0,100% 100%,0 100%)}.integration-item .to-up{transform:translateY(50px);transition:transform .25s}.integration-item .to-up:nth-child(2){transition-delay:.2s}.integration-item.begin-animation .to-up{transform:translate(0)}.footer-links li{margin-left:.75rem;margin-right:.75rem}.animated-link-parent a{display:inline-block;position:relative}.animated-link-parent a:after{content:"";transition-property:width;position:absolute;background-image:linear-gradient(90deg,#47576e,#3e3e3e);transition-duration:.3s;width:0;left:0;bottom:0;height:2px}.animated-link-parent a:active:after,.animated-link-parent a:focus:after,.animated-link-parent a:hover:after{width:100%}.post-content p{margin-top:.75rem;margin-bottom:.75rem}.post-content h1,h2,h3,h4,h5,h6{--text-opacity:1;color:#74a4bc;color:rgba(116,164,188,var(--text-opacity));margin-top:1rem;margin-bottom:1rem}.post-content h1{font-size:3rem}.post-content h2{font-size:2.25rem}.post-content h3{font-size:1.875rem}.post-content h4{font-size:1.5rem}.post-content h5{font-size:1.25rem;font-size:1.125rem}.post-content hr{margin-top:1rem;margin-bottom:1rem;--border-opacity:1;border-color:#cfd8dc;border-color:rgba(207,216,220,var(--border-opacity))}.post-content ul{list-style:disc}.post-content ol{list-style:decimal}.post-content ol,.post-content ul{margin-left:1rem}.post-content ol ol,.post-content ul ul{margin-left:.75rem}.post-content li{margin-top:.5rem;margin-bottom:.5rem;margin-left:1.5rem}.post-content table{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}.post-content table tr{--border-opacity:1;border-color:#cfd8dc;border-left-color:rgba(207,216,220,var(--border-opacity));border-bottom:2px solid #eee;border-bottom-color:rgba(207,216,220,var(--border-opacity));border-right-color:rgba(207,216,220,var(--border-opacity));border-top-color:rgba(207,216,220,var(--border-opacity))}.theme-dark .post-content table tr{border-bottom:2px solid #444}.post-content table tr td,.post-content table tr th{padding:.75rem .5rem;text-align:left}.post-content blockquote{border-left-width:4px;--border-opacity:1;border-color:#47576e;border-color:rgba(71,87,110,var(--border-opacity));padding:0 .75rem;margin:1.5rem 0}.post-content iframe{max-width:100%}.input.focused{padding-left:1rem;padding-right:1rem}.theme-dark .blog-item .focused,.theme-dark .input.focused{background:#222}.spin{-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@media (max-width:640px){html{font-size:15px}}.post-content a{--text-opacity:1;color:#74a4bc;color:rgba(116,164,188,var(--text-opacity));margin-top:1rem;margin-bottom:1rem}.post-content pre{overflow:scroll;color:#fff;background-color:#333;padding:1rem}.post-content img{margin:3rem}.int-title{color:#fff!important}@media (min-width:640px){.sm\:container,.sm\:w-full{width:100%}@media (min-width:640px){.sm\:container{max-width:640px}}@media (min-width:768px){.sm\:container{max-width:768px}}@media (min-width:1024px){.sm\:container{max-width:1024px}}@media (min-width:1280px){.sm\:container{max-width:1280px}}}@media (min-width:768px){.md\:flex{display:flex}.md\:justify-end{justify-content:flex-end}.md\:mt-6{margin-top:1.5rem}.md\:-mt-16{margin-top:-4rem}.md\:px-4{padding-left:1rem;padding-right:1rem}.md\:px-8{padding-left:2rem;padding-right:2rem}.md\:text-right{text-align:right}.md\:w-1\/2{width:50%}.md\:w-3\/4{width:75%}.md\:w-11\/12{width:91.666667%}.md\:container{width:100%}@media (min-width:640px){.md\:container{max-width:640px}}@media (min-width:768px){.md\:container{max-width:768px}}@media (min-width:1024px){.md\:container{max-width:1024px}}@media (min-width:1280px){.md\:container{max-width:1280px}}}@media (min-width:1024px){.lg\:bg-transparent{background-color:transparent}.lg\:box-content{box-sizing:content-box}.lg\:block{display:block}.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:justify-between{justify-content:space-between}.lg\:h-auto{height:auto}.lg\:text-lg{font-size:1.125rem}.lg\:text-xl{font-size:1.25rem}.lg\:text-4xl{font-size:2.25rem}.lg\:text-6xl{font-size:4rem}.lg\:text-7xl{font-size:5rem}.lg\:mt-4{margin-top:1rem}.lg\:mt-12{margin-top:3rem}.lg\:mt-24{margin-top:6rem}.lg\:p-0{padding:0}.lg\:p-4{padding:1rem}.lg\:px-0{padding-left:0;padding-right:0}.lg\:px-6{padding-left:1.5rem;padding-right:1.5rem}.lg\:py-24{padding-top:6rem;padding-bottom:6rem}.lg\:px-24{padding-left:6rem;padding-right:6rem}.lg\:pt-0{padding-top:0}.lg\:pl-8{padding-left:2rem}.lg\:absolute{position:absolute}.lg\:relative{position:relative}.lg\:text-left{text-align:left}.lg\:text-color-default{--text-opacity:1;color:#3e3e3e;color:rgba(62,62,62,var(--text-opacity))}.lg\:text-white{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.lg\:w-1\/2{width:50%}.lg\:w-1\/3{width:33.333333%}.lg\:w-2\/3{width:66.666667%}.lg\:w-3\/4{width:75%}.lg\:w-4\/5{width:80%}.lg\:w-full{width:100%}.theme-dark .lg\:text-color-default{color:#a8a8aa}.lg\:container{width:100%}@media (min-width:640px){.lg\:container{max-width:640px}}@media (min-width:768px){.lg\:container{max-width:768px}}@media (min-width:1024px){.lg\:container{max-width:1024px}}@media (min-width:1280px){.lg\:container{max-width:1280px}}}@media (min-width:1280px){.xl\:container{width:100%}@media (min-width:640px){.xl\:container{max-width:640px}}@media (min-width:768px){.xl\:container{max-width:768px}}@media (min-width:1024px){.xl\:container{max-width:1024px}}@media (min-width:1280px){.xl\:container{max-width:1280px}}}</style><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true">Exploring Lineage History via the Marquez API | OpenLineage</title><link data-react-helmet="true" rel="icon" href="/images/icon.svg" type="image/png"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css2?family=Didact+Gothic&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Taking advantage of recent changes to the Marquez API, this post shows how to diagnose job failures and explore the impact of code changes on downstream dependents."/><meta data-react-helmet="true" property="og:title" content="Exploring Lineage History via the Marquez API"/><meta data-react-helmet="true" property="og:description" content="Taking advantage of recent changes to the Marquez API, this post shows how to diagnose job failures and explore the impact of code changes on downstream dependents."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@openlineage"/><meta data-react-helmet="true" name="twitter:title" content="Exploring Lineage History via the Marquez API"/><meta data-react-helmet="true" name="twitter:description" content="Taking advantage of recent changes to the Marquez API, this post shows how to diagnose job failures and explore the impact of code changes on downstream dependents."/><meta data-react-helmet="true" property="og:image" content="/static/6e9a0b80cf01f773c10e32987279d1e0/banner.svg"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-199717351-1', 'auto', {});
      
      
      
      
      
      }</script><link as="script" rel="preload" href="/webpack-runtime-4a22edadfaf0df2b4dc4.js"/><link as="script" rel="preload" href="/framework-beda7bde9d7dca0755ce.js"/><link as="script" rel="preload" href="/app-bde2b28ded349b605cdb.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-a0d9428a319ddefd2d58.js"/><link as="script" rel="preload" href="/2f4e51e97bf405fb63c5fa7a9b074dbddc2f03d3-2350ed2d501501cbf7b8.js"/><link as="script" rel="preload" href="/component---src-templates-blog-tsx-edf5fc59972dd895bb4a.js"/><link as="fetch" rel="preload" href="/page-data/blog/explore-lineage-api/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1139857438.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1946588481.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2083862410.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2213455283.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2418326273.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2889163238.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3067102388.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="wrapper theme-light"><div class="text-color-default bg-bg"><div class="duration-300 transition-all flex justify-center lg:justify-between items-center z-20 fixed w-full nav p-5"><button class="absolute text-primary outline-0 lg:hidden" style="transform:translateY(-50%);top:50%;left:10px"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><div class="r-swipe-sidebar-container" style="position:absolute"><div class="r-swipe-sidebar" style="position:fixed;left:-100%;width:70%;height:100%;top:0;z-index:9999;transition-property:left;transition-duration:0s;transition-timing-function:linear;transform:translate3d(0,0,0)"><div class="bg-bg h-full flex flex-col justify-center relative"><div class="absolute top-0 my-4 text-center w-full"><a title="OpenLineage" class="inline-block" href="/"><img src="/images/ol-logo.svg" alt="OpenLineage - logo" class="duration-300 transition-all h-8"/></a></div><div class="text-center"><ul class=""><li class="block my-2 "><a title="Home" class="text-color-2 focus:text-primary" href="/"><span>Home</span></a></li><li class="block my-2 "><a title="Getting Started" class="text-color-2 focus:text-primary" href="/getting-started"><span>Getting Started</span></a></li><li class="block my-2 "><a title="Integrations" class="text-color-2 focus:text-primary" href="/integration"><span>Integrations</span></a></li><li class="block my-2 active"><a title="Blog" class="text-color-2 focus:text-primary" href="/blog"><span>Blog</span></a></li></ul></div></div></div><div class="r-swipe-sidebar-overlay" role="button" tabindex="-1" style="position:fixed;top:0;bottom:0;left:-100%;width:100%;height:100%;background:#000;z-index:9998;transition-property:opacity;transition-duration:0s;opacity:0"></div></div><a title="OpenLineage" href="/"><img src="/images/ol-logo.svg" alt="OpenLineage - logo" class="duration-300 transition-all h-8"/></a><div class="hidden lg:block"><ul class="nav-links flex"><li class=" "><a title="Home" class="text-color-2 focus:text-primary" href="/"><span>Home</span></a></li><li class=" "><a title="Getting Started" class="text-color-2 focus:text-primary" href="/getting-started"><span>Getting Started</span></a></li><li class=" "><a title="Integrations" class="text-color-2 focus:text-primary" href="/integration"><span>Integrations</span></a></li><li class=" active"><a title="Blog" class="text-color-2 focus:text-primary" href="/blog"><span>Blog</span></a></li></ul></div><div class="absolute line h-px left-0 bottom-0 bg-gradient-primary"></div></div><div style="height:0px"></div><div class="md:px-4 mt-12 py-6 md:w-11/12 mx-auto"><div class="mx-auto relative"><img src="/static/6e9a0b80cf01f773c10e32987279d1e0/banner.svg" alt="&#x27;&#x27;"/><div class="relative w-full lg:w-3/4 md:w-11/12 sm:w-full p-6 box-border lg:box-content mx-auto bg-bg text-color-default blog-wall-content shadow-xl md:-mt-16 "><div class="p-3"><h1 class="text-5xl font-bold text-primary">Exploring Lineage History via the Marquez API</h1><p class="mt-1 flex"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> <span class="ml-2">08 July 2021<!-- --> by <!-- -->Michael Collado</span></p><p class="mt-3">Taking advantage of recent changes to the Marquez API, this post shows how to diagnose job failures and explore the impact of code changes on downstream dependents.</p></div></div></div><div class="lg:w-3/4 md:w-11/12 sm:w-full p-3 mx-auto mt-12 post-content"><p>Managing a data pipeline means tracking changes. Sometimes changes to your code, sometimes changes to
somebody else’s schema, sometimes to the contents of the data itself. Sometimes you need to
trace the root cause of a problem- somebody changed an int to a string and all the downstream consumers
broke.</p><p>Sometimes you want to make a change and see how your consumers were affected- do all the jobs
run significantly faster after you filter out <!-- -->“<!-- -->unused<!-- -->”<!-- --> records? Or did somebody <a href="https://www.hyrumslaw.com/">rely on those
<!-- -->“<!-- -->unused<!-- -->”<!-- --> records</a> to be present in the data?</p><p>Do the recommendation models perform better after you &quot;improved&quot; the data cleaning job upstream? Can
you be certain it was your change that improved the performance?</p><p>Sometimes the data itself just looks wrong and you need a way to verify that nothing has broken. Why
was there a huge drop in traffic to the food delivery site yesterday? Was there an outage you didn&#x27;t
hear about? Competitors outbidding your ads? Or did the website developers simply stop logging some
critical event, corrupting every table in your data warehouse?</p><p>Typically, we think of data lineage in static terms-</p><blockquote><p>Job A produces Dataset X, which is consumed by Job B which joins it with Dataset Y and produces
Dataset Z, which is consumed by<!-- -->…</p></blockquote><p>It’s a map
that we use to get our heads around the dependencies that exist between the datasets we use to make
good decisions (how much inventory should I stock in the warehouse to ensure customers get timely
deliveries?) or to make technical features our customers will love (how can I compile the perfect
road trip playlist given this customer&#x27;s listening history?).</p><p>But data lineage is much more than a static map of inputs and outputs. <em>Real time</em> lineage and faceted
metadata give us visibility into how the map changes over time and even allow us to look back in
history to see how changes in one part of the map cause ripples in other areas. Taking advantage of some
recent changes to the Marquez API, we’ll demonstrate how to diagnose job failures and how to explore
the impact of code changes on downstream dependents.</p><h2>Getting Started</h2><p>To get started, we need a running instance of Marquez with a little bit of seed data. For these
exercises, we&#x27;ll assume you have a terminal with the following programs installed</p><ul><li><a href="https://www.docker.com/products/docker-desktop">docker</a></li><li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">git</a></li><li><a href="https://curl.se/download.html">curl</a></li><li><a href="https://stedolan.github.io/jq/download/">jq</a></li><li>less (optional)</li></ul><p>Download and install any dependencies you don&#x27;t already have. You&#x27;ll need the docker daemon running
(see the docs for your platform to get that started). Then check out the Marquez repository
from Github and run the docker image locally:</p><pre><code class="language-bash">git clone https://github.com/MarquezProject/marquez
cd marquez
./docker/up.sh --seed
</code></pre><p>This script uses <code>docker-compose</code> to spin up a self-contained installation of Marquez, including a
local database container, web frontend, and service instance. Additionally, it populates a set of
sample data that&#x27;s useful for exploring the API. You&#x27;ll know when the seed job is done when you see
the following line in the output logs</p><pre><code>seed-marquez-with-metadata exited with code 0
</code></pre><p>Once the seed job is done, we can begin exploring the API.</p><h3>The Jobs</h3><p>In a separate terminal window, type the following command</p><pre><code class="language-bash">curl &quot;http://localhost:5000/api/v1/namespaces/food_delivery/jobs/&quot; | jq | less
</code></pre><p>The output returned should look something like the following</p><pre><code class="language-json">{
  &quot;jobs&quot;: [
    {
      &quot;id&quot;: {
        &quot;namespace&quot;: &quot;food_delivery&quot;,
        &quot;name&quot;: &quot;example.delivery_times_7_days&quot;
      },
      &quot;type&quot;: &quot;BATCH&quot;,
      &quot;name&quot;: &quot;example.delivery_times_7_days&quot;,
      &quot;createdAt&quot;: &quot;2021-06-24T21:50:39.229759Z&quot;,
      &quot;updatedAt&quot;: &quot;2021-06-24T22:05:45.321952Z&quot;,
      &quot;namespace&quot;: &quot;food_delivery&quot;,
      &quot;inputs&quot;: [
        {
          &quot;namespace&quot;: &quot;food_delivery&quot;,
          &quot;name&quot;: &quot;public.delivery_7_days&quot;
        }
      ],
      &quot;outputs&quot;: [],
      &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/delivery_times_7_days.py&quot;,
      &quot;context&quot;: {
        &quot;sql&quot;: &quot;INSERT INTO top_delivery_times (order_id, order_placed_on, order_dispatched_on, order_delivered_on, order_delivery_time,\n    customer_email, restaurant_id, driver_id)\n  SELECT order_id, order_placed_on, order_delivered_on, DATEDIFF(minute, order_placed_on, order_delivered_on) AS order_delivery_time,\n    customer_email, restaurant_id, driver_id\n    FROM delivery_7_days\nGROUP BY restaurant_id\nORDER BY order_delivery_time DESC\n   LIMIT 1;&quot;
      },
      &quot;description&quot;: &quot;Determine weekly top delivery times by restaurant.&quot;,
      &quot;latestRun&quot;: {
        &quot;id&quot;: &quot;f4fada30-dfcc-400c-9391-2d7a506b9139&quot;,
        &quot;createdAt&quot;: &quot;2021-06-24T21:50:59.509739Z&quot;,
        &quot;updatedAt&quot;: &quot;2021-06-24T22:05:45.321952Z&quot;,
        &quot;nominalStartTime&quot;: &quot;2021-06-24T22:02:00Z&quot;,
        &quot;nominalEndTime&quot;: &quot;2021-06-24T22:05:00Z&quot;,
        &quot;state&quot;: &quot;FAILED&quot;,
        &quot;startedAt&quot;: &quot;2021-06-24T22:02:39.321952Z&quot;,
        &quot;endedAt&quot;: &quot;2021-06-24T22:05:45.321952Z&quot;,
        &quot;durationMs&quot;: 186000,
        &quot;args&quot;: {},
        &quot;jobVersion&quot;: {
          &quot;namespace&quot;: &quot;food_delivery&quot;,
          &quot;name&quot;: &quot;example.delivery_times_7_days&quot;,
          &quot;version&quot;: &quot;e9eafa5b-e334-358d-a3b4-61c8d3de75f3&quot;
        },
        &quot;inputDatasetVersions&quot;: [
          {
            &quot;namespace&quot;: &quot;food_delivery&quot;,
            &quot;name&quot;: &quot;public.delivery_7_days&quot;,
            &quot;version&quot;: &quot;a40ec54f-b8e1-35f7-b868-58b27383b5ff&quot;
          }
        ],
        &quot;outputDatasetVersions&quot;: [],
        &quot;context&quot;: {
          &quot;sql&quot;: &quot;INSERT INTO top_delivery_times (order_id, order_placed_on, order_dispatched_on, order_delivered_on, order_delivery_time,\n    customer_email, restaurant_id, driver_id)\n  SELECT order_id, order_placed_on, order_delivered_on, DATEDIFF(minute, order_placed_on, order_delivered_on) AS order_delivery_time,\n    customer_email, restaurant_id, driver_id\n    FROM delivery_7_days\nGROUP BY restaurant_id\nORDER BY order_delivery_time DESC\n   LIMIT 1;&quot;
        },
        &quot;facets&quot;: {}
      },
      &quot;facets&quot;: {}
    },
   ...
  ]
}
</code></pre><p>For brevity, I only included a single job- in this case, a job called <code>example.delivery_times_7_days</code>
in the <code>food_delivery</code> namespace (which we specified in the curl command). Your output will include
many more jobs.</p><p>There are a few things in the job output worth noting. The first is the id of the job:</p><pre><code class="language-json">      &quot;id&quot;: {
        &quot;namespace&quot;: &quot;food_delivery&quot;,
        &quot;name&quot;: &quot;example.delivery_times_7_days&quot;
      },
</code></pre><p>There is no version information in the id, as this API refers to the unversioned job information. The
job itself is mutable, in the sense that each time you query the API, the content of the job may
change as new versions are created.</p><p>The response includes the set of input and output datasets, as well as the current job source location:</p><pre><code class="language-json">      &quot;inputs&quot;: [
        {
          &quot;namespace&quot;: &quot;food_delivery&quot;,
          &quot;name&quot;: &quot;public.delivery_7_days&quot;
        }
      ],
      &quot;outputs&quot;: [],
      &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/delivery_times_7_days.py&quot;,
</code></pre><p>If a new version of the job is created, any or all of these fields can change.</p><h3>The Job Run</h3><p>The next thing to notice is the <code>latestRun</code> field. This includes information about the latest Run
of this job:</p><pre><code class="language-json">      &quot;latestRun&quot;: {
        &quot;id&quot;: &quot;f4fada30-dfcc-400c-9391-2d7a506b9139&quot;,
        &quot;createdAt&quot;: &quot;2021-06-24T21:50:59.509739Z&quot;,
        &quot;updatedAt&quot;: &quot;2021-06-24T22:05:45.321952Z&quot;,
        &quot;nominalStartTime&quot;: &quot;2021-06-24T22:02:00Z&quot;,
        &quot;nominalEndTime&quot;: &quot;2021-06-24T22:05:00Z&quot;,
        &quot;state&quot;: &quot;FAILED&quot;,
        &quot;startedAt&quot;: &quot;2021-06-24T22:02:39.321952Z&quot;,
        &quot;endedAt&quot;: &quot;2021-06-24T22:05:45.321952Z&quot;,
        &quot;durationMs&quot;: 186000,
        &quot;args&quot;: {},
        &quot;jobVersion&quot;: {
          &quot;namespace&quot;: &quot;food_delivery&quot;,
          &quot;name&quot;: &quot;example.delivery_times_7_days&quot;,
          &quot;version&quot;: &quot;e9eafa5b-e334-358d-a3b4-61c8d3de75f3&quot;
        },
        &quot;inputDatasetVersions&quot;: [
          {
            &quot;namespace&quot;: &quot;food_delivery&quot;,
            &quot;name&quot;: &quot;public.delivery_7_days&quot;,
            &quot;version&quot;: &quot;a40ec54f-b8e1-35f7-b868-58b27383b5ff&quot;
          }
        ],
        &quot;outputDatasetVersions&quot;: [],
        &quot;context&quot;: {
          &quot;sql&quot;: &quot;INSERT INTO top_delivery_times (order_id, order_placed_on, order_dispatched_on, order_delivered_on, order_delivery_time,\n    customer_email, restaurant_id, driver_id)\n  SELECT order_id, order_placed_on, order_delivered_on, DATEDIFF(minute, order_placed_on, order_delivered_on) AS order_delivery_time,\n    customer_email, restaurant_id, driver_id\n    FROM delivery_7_days\nGROUP BY restaurant_id\nORDER BY order_delivery_time DESC\n   LIMIT 1;&quot;
        },
        &quot;facets&quot;: {}
      },
</code></pre><p>Here, we see explicit version information in the <code>jobVersion</code>, the <code>inputDatasetVersions</code>, and the
<code>outputDatasetVersions</code> fields. This is included because every Run is tied to exactly one immutable
version of a job and one immutable version of each input dataset and each output dataset (it&#x27;s worth
noting that a Run can be tied to one version of a dataset as its input and another version of the
same dataset as its output- a SQL <code>MERGE</code> statement is one common use case supported by this).</p><p>The other important field to notice in the Run structure is the <code>state</code></p><pre><code class="language-json">        &quot;state&quot;: &quot;FAILED&quot;,
</code></pre><p>Uh-oh. Looks like the last time this job ran, it failed.</p><h2>Tracing Failures</h2><p>The first question we have when diagnosing a failure is</p><blockquote><p>Is this the first time it&#x27;s failed? Or has it been broken a while?</p></blockquote><p>Let&#x27;s use the API to find out. Checking previous runs is easily accomplished by hitting the job&#x27;s <code>runs</code>
API. Job runs are returned in descending order by start time, so the latest runs should be at the top.
Since we only want to check whether (and which) previous runs failed, we can use the following command:</p><pre><code class="language-bash">curl &quot;http://localhost:5000/api/v1/namespaces/food_delivery/jobs/example.delivery_times_7_days/runs&quot; | \
  jq &#x27;.runs | map({&quot;id&quot;: .id, &quot;state&quot;: .state})&#x27; | less
</code></pre><p>I get the following output:</p><pre><code class="language-json">[
  {
    &quot;id&quot;: &quot;cb436906-1c66-4ce4-b7ac-ceebfd1babf8&quot;,
    &quot;state&quot;: &quot;FAILED&quot;
  },
  {
    &quot;id&quot;: &quot;34bd4d60-82a6-4cac-ad76-815e6d95a93c&quot;,
    &quot;state&quot;: &quot;COMPLETED&quot;
  },
  {
    &quot;id&quot;: &quot;352c67c3-c8d7-4b3a-b7da-8532aa9b8335&quot;,
    &quot;state&quot;: &quot;COMPLETED&quot;
  },
  {
    &quot;id&quot;: &quot;0c62b1cc-2e43-44d0-9443-0a1d9768fece&quot;,
    &quot;state&quot;: &quot;COMPLETED&quot;
  },
  {
    &quot;id&quot;: &quot;5900de19-12f7-4a6e-8118-8e0792d98f65&quot;,
    &quot;state&quot;: &quot;COMPLETED&quot;
  },
  ...
]
</code></pre><p>This is an incomplete list of jobs, but it&#x27;s obvious from this sampling that this is the first job failure
in the recent execution history. What we want to see now is what changed between the last successful
run and this one. We&#x27;ll need to grab the <code>id</code> fields of each of the runs we want to compare. The run
ids in the seed data are randomly generated, so they&#x27;ll be different if you&#x27;re following along. Grab
the run ids with the following shell commands:</p><pre><code class="language-bash">FAILED_RUN_ID=$(curl &quot;http://localhost:5000/api/v1/namespaces/food_delivery/jobs/example.delivery_times_7_days/runs&quot; | jq -r &#x27;.runs[0].id&#x27;)
SUCCESSFUL_RUN_ID=$(curl &quot;http://localhost:5000/api/v1/namespaces/food_delivery/jobs/example.delivery_times_7_days/runs&quot; | jq -r &#x27;.runs[1].id&#x27;)
</code></pre><p>To get a specific run, we call the <code>/jobs/runs</code> API. Since each Run ID is required to be unique, the
API doesn&#x27;t require a namespace or a job name. We can get the failed job run with</p><pre><code class="language-bash">curl &quot;http://localhost:5000/api/v1/jobs/runs/$FAILED_RUN_ID&quot; | jq | less
</code></pre><p>The output is the same as the <code>latestRun</code> field of the <code>JobVersions</code> API. Recall the output of that
API includes these three important fields: the <code>jobVersion</code>, the <code>inputDatasetVersions</code>
and the <code>outputDatasetVersions</code>.</p><pre><code class="language-json">        &quot;jobVersion&quot;: {
          &quot;namespace&quot;: &quot;food_delivery&quot;,
          &quot;name&quot;: &quot;example.delivery_times_7_days&quot;,
          &quot;version&quot;: &quot;e9eafa5b-e334-358d-a3b4-61c8d3de75f3&quot;
        },
        &quot;inputDatasetVersions&quot;: [
          {
            &quot;namespace&quot;: &quot;food_delivery&quot;,
            &quot;name&quot;: &quot;public.delivery_7_days&quot;,
            &quot;version&quot;: &quot;a40ec54f-b8e1-35f7-b868-58b27383b5ff&quot;
          }
        ],
        &quot;outputDatasetVersions&quot;: [],
</code></pre><p>These fields give us what we need to trace the lineage of the specific job runs we want to compare.</p><h3>Job Versions</h3><p>The first thing to look at is the <code>jobVersion</code>. Nearly 100% of the time, a job failure can be traced
to a code change. Let&#x27;s compare the job version of the failed run with the job version of the successful
one:</p><pre><code class="language-bash">diff &lt;(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$FAILED_RUN_ID&quot; | jq -r &#x27;.jobVersion.version&#x27;) \
     &lt;(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$SUCCESSFUL_RUN_ID&quot; | jq -r &#x27;.jobVersion.version&#x27;)
1c1
&lt; e9eafa5b-e334-358d-a3b4-61c8d3de75f3
---
&gt; 92d801c0-021e-3c3d-ba18-c9e8504b143d
</code></pre><p>Right away, we see there is a difference. A number of factors contribute to the job versioning logic
in Marquez:</p><ul><li>The source code location</li><li>The job context</li><li>The list of input datasets</li><li>The list of output datasets</li></ul><p>The version generation code is a deterministic function of these four inputs, so if any of them change,
the version will change. Let&#x27;s find out what changed between the two job versions. To do the diff,
we ought to get rid of anything we expect to differ ahead of time: the <code>version</code>, the <code>createdAt</code>
and <code>updatedAt</code> timestamps, and the <code>latestRun</code>. The <code>version</code> field is also nested within the job
version&#x27;s <code>id</code> field, so we&#x27;ll omit that too.</p><pre><code class="language-bash">FAILED_JOB_VERSION=$(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$FAILED_RUN_ID&quot; | jq -r &#x27;.jobVersion.version&#x27;)
SUCCESSFUL_JOB_VERSION=$(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$SUCCESSFUL_RUN_ID&quot; | jq -r &#x27;.jobVersion.version&#x27;)

diff &lt;(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/jobs/example.delivery_times_7_days/versions/$FAILED_JOB_VERSION&quot; | \
      jq &#x27;del(.[&quot;id&quot;, &quot;version&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot;, &quot;latestRun&quot;])&#x27;) \
     &lt;(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/jobs/example.delivery_times_7_days/versions/$SUCCESSFUL_JOB_VERSION&quot; | \
      jq &#x27;del(.[&quot;id&quot;, &quot;version&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot;, &quot;latestRun&quot;])&#x27;)
14c14,23
&lt;   &quot;outputs&quot;: []
---
&gt;   &quot;outputs&quot;: [
&gt;     {
&gt;       &quot;namespace&quot;: &quot;food_delivery&quot;,
&gt;       &quot;name&quot;: &quot;public.top_delivery_times&quot;
&gt;     },
&gt;     {
&gt;       &quot;namespace&quot;: &quot;food_delivery&quot;,
&gt;       &quot;name&quot;: &quot;public.discounts&quot;
&gt;     }
&gt;   ]
</code></pre><p>Oh, interesting! The two job versions only differ because of the output datasets. This is an
interesting point that should be addressed in the Marquez API- the version generation is constructed
when the run completes, <em>even if the job run failed</em>. Sometimes this has no impact on the versioning,
as the output datasets can be determined before the job run executes. But sometimes we see impacts
like this where a job run failed before we had a chance to discover the output datasets.</p><h2>Tracing Upstream Lineage</h2><p>So what gives? The job code didn&#x27;t actually change! So what caused the failure?</p><p>Here&#x27;s where the lineage tracking becomes useful. Recall again, the run output gave us
3 interesting fields: the <code>jobVersion</code>, the <code>inputDatasetVersions</code>, and the <code>outputDatasetVersions</code>.
We already know that the <code>outputDatasetVersions</code> is empty because the latest failed run didn&#x27;t have
a chance to determine the outputs. But we can take a look at the input datasets.</p><h3>Dataset Versions</h3><pre><code class="language-bash">diff &lt;(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$FAILED_RUN_ID&quot; | jq -r &#x27;.inputDatasetVersions&#x27;) \
     &lt;(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$SUCCESSFUL_RUN_ID&quot; | jq -r &#x27;.inputDatasetVersions&#x27;)
5c5
&lt;     &quot;version&quot;: &quot;a40ec54f-b8e1-35f7-b868-58b27383b5ff&quot;
---
&gt;     &quot;version&quot;: &quot;5e439f1f-1a44-3700-961f-60c79c75a1ec&quot;
</code></pre><p>Dataset versions work differently from job versions. They don&#x27;t only change when the structure changes.
Every time a job run <em>modifies or writes to</em> a dataset, the dataset version changes. Unless a job schedule is more
frequent than its upstream job&#x27;s schedule (e.g., an hourly job consuming a daily generated dataset),
it is expected that each job run consumes a different version of a dataset. To find out if there is
a significant difference, we have to compare the two versions with the dataset&#x27;s <code>versions</code> API.</p><p>We know there&#x27;s only a single input dataset, so we&#x27;ll keep this simple, but you could also write a loop to
check multiple input datasets if needed.</p><p>In this post, we omit the structure of the <code>datasetVersion</code>, but you can explore it yourself with the following:</p><pre><code class="language-bash">FAILED_DATASET_VERSION=$(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$FAILED_RUN_ID&quot; | jq -r &#x27;.inputDatasetVersions[0].version&#x27;)
curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/datasets/public.delivery_7_days/versions/$FAILED_DATASET_VERSION&quot; | jq | less
</code></pre><p>As with the job versions, we&#x27;ll omit some of the data we expect to be different in order to produce
a useful diff:</p><pre><code class="language-bash">FAILED_DATASET_VERSION=$(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$FAILED_RUN_ID&quot; | jq -r &#x27;.inputDatasetVersions[0].version&#x27;)
SUCCESSFUL_DATASET_VERSION=$(curl -s &quot;http://localhost:5000/api/v1/jobs/runs/$SUCCESSFUL_RUN_ID&quot; | jq -r &#x27;.inputDatasetVersions[0].version&#x27;)

diff &lt;(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/datasets/public.delivery_7_days/versions/$FAILED_DATASET_VERSION&quot; | \
      jq &#x27;del(.[&quot;id&quot;, &quot;version&quot;, &quot;createdAt&quot;, &quot;createdByRun&quot;])&#x27;) \
     &lt;(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/datasets/public.delivery_7_days/versions/$SUCCESSFUL_DATASET_VERSION&quot; | \
      jq &#x27;del(.[&quot;id&quot;, &quot;version&quot;, &quot;createdAt&quot;, &quot;createdByRun&quot;])&#x27;)
58c58
&lt;       &quot;type&quot;: &quot;VARCHAR&quot;,
---
&gt;       &quot;type&quot;: &quot;INTEGER&quot;,
</code></pre><p>Hey! Somehow one of the fields was converted from a an <code>INT</code> to a <code>VARCHAR</code>! One of the helpful fields
in the <code>version</code> API is the <code>createdByRun</code>, which is similar to the <code>jobVersion</code>&#x27;s <code>latestRun</code>.
It provides the job run that last altered the dataset, creating the new version.</p><p>We can quickly compare the job versions of the runs that created these two dataset versions:</p><pre><code class="language-bash">diff &lt;(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/datasets/public.delivery_7_days/versions/$FAILED_DATASET_VERSION&quot; | \
      jq &#x27;.createdByRun.jobVersion&#x27;) \
    &lt;(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/datasets/public.delivery_7_days/versions/$SUCCESSFUL_DATASET_VERSION&quot; | \
      jq &#x27;.createdByRun.jobVersion&#x27;)
4c4
&lt;   &quot;version&quot;: &quot;c222a72e-92cc-3bb6-b3b7-c174cbc76387&quot;
---
&gt;   &quot;version&quot;: &quot;76c375bf-58ac-3d19-b94f-424fe2784601&quot;
</code></pre><p>And we can do a quick comparison of the two job versions. Since the job name is different,
we&#x27;ll let jq generate the endpoints for us</p><pre><code class="language-bash">diff &lt;(curl -s $(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/datasets/public.delivery_7_days/versions/$FAILED_DATASET_VERSION&quot; | \
      jq -r &#x27;.createdByRun.jobVersion | &quot;http://localhost:5000/api/v1/namespaces/&quot; + .namespace + &quot;/jobs/&quot; + .name + &quot;/versions/&quot; + .version&#x27;) | \
      jq &#x27;del(.[&quot;id&quot;, &quot;version&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot;, &quot;latestRun&quot;])&#x27;) \
    &lt;(curl -s $(curl -s &quot;http://localhost:5000/api/v1/namespaces/food_delivery/datasets/public.delivery_7_days/versions/$SUCCESSFUL_DATASET_VERSION&quot; | \
      jq -r &#x27;.createdByRun.jobVersion | &quot;http://localhost:5000/api/v1/namespaces/&quot; + .namespace + &quot;/jobs/&quot; + .name + &quot;/versions/&quot; + .version&#x27;) | \
      jq &#x27;del(.[&quot;id&quot;, &quot;version&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot;, &quot;latestRun&quot;])&#x27;)
4c4
&lt;   &quot;location&quot;: &quot;https://github.com/example/jobs/blob/c87f2a40553cfa4ae7178083a068bf1d0c6ca3a8/etl_delivery_7_days.py&quot;,
---
&gt;   &quot;location&quot;: &quot;https://github.com/example/jobs/blob/4d0b5d374261fdaf60a1fc588dd8f0d124b0e87f/etl_delivery_7_days.py&quot;,
</code></pre><p>And there it is. Because nearly 100% of the time, a job failure can be traced to a code change. In
this example, the job immediately upstream decided to change the output schema of its dataset. In
reality, it&#x27;s not always so straightforward. Sometimes the upstream job is just a passthrough- maybe
it applies some filters to a subset of the columns and writes out whatever schema it&#x27;s given.
In that case, the job immediately upstream would have succeeded without a change in the job version.
Or the code change in the upstream job could be innocuous. Maybe someone added a comment or fixed an
unrelated bug. We might do some follow up and discover we have to continue our search upstream.</p><p>But the Marquez API actually gives us that ability. Using the <code>/lineage</code> API, we can even explore the
downsteam impact of changes. So if you owned the <code>etl_delivery_7_days</code> job and wanted to see what the
impact of changing the varchar to an int was on running jobs, the following jq recursive script
will let you walk the downstream jobs and show the state of the last run:</p><pre><code class="language-bash"># For readability, the jq filter is in a file broken into multiple lines
cat recurse.jq
  .graph as $graph | .graph[]
  | select(.id == &quot;job:food_delivery:example.etl_delivery_7_days&quot;)
  | recurse(.outEdges[] | .destination as $nodeId | $graph[] | select(.id == $nodeId))
  | select(.type == &quot;JOB&quot;)
  | {&quot;id&quot;: .id, &quot;state&quot;: .data.latestRun.state}

curl -s &quot;http://localhost:5000/api/v1-beta/lineage?nodeId=job:food_delivery:example.etl_delivery_7_days&quot; | jq -f recurse.jq less
{
  &quot;id&quot;: &quot;job:food_delivery:example.etl_delivery_7_days&quot;,
  &quot;state&quot;: &quot;COMPLETED&quot;
}
{
  &quot;id&quot;: &quot;job:food_delivery:example.delivery_times_7_days&quot;,
  &quot;state&quot;: &quot;FAILED&quot;
}
</code></pre><p>In this post, we did everything manually with bash (because the shell is your most powerful tool when
debugging a live outage you&#x27;ve never encountered before; and let&#x27;s be honest- how many outages <em>aren&#x27;t</em>
something you&#x27;ve never encountered before), but this could easily have been done in Java or Go or Python.
The <a href="https://github.com/MarquezProject/marquez/blob/main/spec/openapi.yml">openapi spec</a>
in the Marquez repo can be used to generate a client in whatever language you want to write your ops
tool in. So build some tooling and help your next debugging session run a little more smoothly.</p><blockquote><p>But wait! What about the times when the job isn&#x27;t <em>failing</em>, but the data is wrong!</p></blockquote><p>Ah, the data quality checks! This is where the extensibility of the OpenLineage model comes to our
rescue with a field in the responses that we completely glossed over</p><pre><code class="language-json">      &quot;facets&quot;: {}
</code></pre><p>But I think that&#x27;s a topic for another post.</p></div><div class="comments mt-8"><div id="disqus_thread" url="https://openlineage.io[object Object]" title="Exploring Lineage History via the Marquez API" identifier="Exploring Lineage History via the Marquez API" counter="0"></div></div></div><footer class="footer bg-bgalt py-12"><div class="container mx-auto text-center"><div class="flex justify-center my-3 mb-6"><a title="OpenLineage" href="/"><img src="/images/ol-logo.svg" alt="OpenLineage - logo" class="w-40"/></a></div><div class="text-color-2 my-3 footer-links animated-link-parent"><ul class="flex items-center justify-center flex-wrap"><li class=" "><a title="Home" class="text-color-2 focus:text-primary" href="/"><span>Home</span></a></li><li class=" "><a title="Getting Started" class="text-color-2 focus:text-primary" href="/getting-started"><span>Getting Started</span></a></li><li class=" "><a title="Integrations" class="text-color-2 focus:text-primary" href="/integration"><span>Integrations</span></a></li><li class=" "><a title="Blog" class="text-color-2 focus:text-primary" href="/blog"><span>Blog</span></a></li></ul></div><div class="text-color-2 my-3"><ul><li class="inline-block mx-3 animated-link-parent"><a href="https://twitter.com/OpenLineage" title="Twitter"><span>Twitter</span></a></li><li class="inline-block mx-3 animated-link-parent"><a href="http://bit.ly/OpenLineageSlack" title="Slack"><span>Slack</span></a></li><li class="inline-block mx-3 animated-link-parent"><a href="https://github.com/OpenLineage" title="GitHub"><span>GitHub</span></a></li></ul></div><p class="text-color-default text-lg">Copyright © <!-- -->2021<!-- --> The Linux Foundation®. All rights reserved.</p></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/explore-lineage-api/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-404a8fe84b9b126210e7.js"],"app":["/app-bde2b28ded349b605cdb.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-446fa3a5db06571e140f.js"],"component---src-pages-contact-tsx":["/component---src-pages-contact-tsx-00a5b837a729335aca76.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-edccbcb78163ca5f170c.js"],"component---src-templates-basepages-tsx":["/component---src-templates-basepages-tsx-71e7c2eb707ed814873d.js"],"component---src-templates-blog-list-tsx":["/component---src-templates-blog-list-tsx-23a6f0ba0c31c3bdce62.js"],"component---src-templates-blog-tsx":["/component---src-templates-blog-tsx-edf5fc59972dd895bb4a.js"],"component---src-templates-integration-list-tsx":["/component---src-templates-integration-list-tsx-b7dc564d5c591e93403c.js"],"component---src-templates-integration-tsx":["/component---src-templates-integration-tsx-b1f02b8f04e2aa5fd0bc.js"]};/*]]>*/</script><script src="/polyfill-404a8fe84b9b126210e7.js" nomodule=""></script><script src="/component---src-templates-blog-tsx-edf5fc59972dd895bb4a.js" async=""></script><script src="/2f4e51e97bf405fb63c5fa7a9b074dbddc2f03d3-2350ed2d501501cbf7b8.js" async=""></script><script src="/commons-a0d9428a319ddefd2d58.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-bde2b28ded349b605cdb.js" async=""></script><script src="/framework-beda7bde9d7dca0755ce.js" async=""></script><script src="/webpack-runtime-4a22edadfaf0df2b4dc4.js" async=""></script></body></html>